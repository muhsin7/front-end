<!DOCTYPE html>
<html>
  <head>
    <!-- /////////////////////////////////////////////////////// -->
    <link rel="stylesheet" href="../css/icons.css">
    <link rel="stylesheet" href="../css/materialize.css">
    <link rel="stylesheet" href="../css/materialize.css">
    <link rel="stylesheet" href="../css/nord-colours.css">
    <link rel="stylesheet" href="../css/styles.css">
    <!-- /////////////////////////////////////////////////////// -->

  </head>
  <body>

    <div class="modal" id="editModal">
      <div class="modal-content">
        <div>
          <h5>Edit post</h5>
          <input type="hidden" name="postID" id="edit-postID">
          <div class="input-field">
            <!-- <i class="material-icons prefix">mode_edit</i> -->
            <textarea class="materialize-textarea" id="editPostContent">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</textarea>
          </div>
          <div class="row">
            <ul class="collection files" id="edit-old-file-container">
              <session-error>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-red remove_file tiny">close</i></a></div></li>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-red remove_file tiny">close</i></a></div></li>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-red remove_file tiny">close</i></a></div></li>
              </session-error>
            </ul>
          </div>
          <div class="row">
            <a class="btn nord-red">
              <span class="valign-wrapper" id="edit-attach-file-button"><i class="material-icons">attach_file</i>Attach (more) files</span>
              <input type="file" multiple id="edit-attach-file" class="hidden">
            </a>
          </div>
          <div class="row">
            <ul class="collection files" id="edit-new-file-container">

            </ul>
          </div>
          <button type="submit" name="button" class="btn-large nord-darkblue" id="edit-submit">Post</button>
          <div class="btn-large nord-red modal-close">Cancel</div>
        </div>
      </div>
    </div>
    <div class="modal" id="deleteCommentModal">
      <div class="modal-content">
        <center>
          <div class="form" method="POST" action="/api/post/comment/delete" on-success-reload="true" on-error="console.error(response)">
            <input type="text" class='hidden' name="commentID" value="" id="deleteCommentId">
            <h5>Are you sure you want to delete this comment?</h5>
            <br />
            <button class="btn-large nord-red" type="submit">Delete comment</button>
            <div class="btn-large nord-darkblue modal-close">Cancel</div>
          </div>
        </center>
      </div>
    </div>
    <div class="modal form" action="/api/post/delete" method="post" on-success-reload="true" id="deletePostModal">
      <div class="modal-content">
        <center>
          <h5>Are you sure you want to delete this post?</h5>
          <br />
          <input type="hidden" name="postID" value="" id="deletePostId">
          <button class="btn-large nord-red" type="submit">Delete post</button>
          <div class="btn-large nord-darkblue modal-close">Cancel</div>
        </center>
      </div>
    </div>
    <div class="fixed-action-btn">
      <a class="btn-floating btn-large nord-red modal-trigger" href="#post">
        <i class="large material-icons">mode_edit</i>
      </a>
   </div>
   <!-- <div class="modal modal-fixed-footer">
     <div class="modal-content">
       <center>
         <h4>Post to ${class}</h4>
       </center>
        <div>
          <label>Content</label>
          <div class="row">
            <div class="input-field col s12">
              <textarea id="icon_prefix2" class="materialize-textarea" name="postContent" placeholder="Enter Content of post"></textarea>
              <!-- <label for="icon_prefix2">Enter Post</label> -->
            </div>
          </div>
        </div>
        <div id="postError" class="red-text">

        </div>
     </div>
   </div>
   <div class="modal modal-fixed-footer" id="post">
     <div class="modal-content">
        <div>
          <div class="row">
            <center>
              <h2>Post to ${class}</h2>
            </center>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <!-- <i class="material-icons prefix">mode_edit</i> -->
              <textarea class="materialize-textarea" min-length="5" required placeholder="Enter content of post" name="content" id="post-content"></textarea>
              <!-- <label for="icon_prefix2">Enter Post</label> -->
            </div>
          </div>
          <div class="row">
            <div id="post-error" style="color:red">

            </div>
          </div>
          <div class="row">
              <a class="btn nord-red">
                <span class="valign-wrapper" id="post-attach-files-button"><i class="material-icons">attach_file</i>Attach file</span>
                <input type="file" class="hidden" multiple id="post-files">
              </a>
          </div>
          <div class="row">
            <ul class="collection files" id="post-file-collection">
              <session-error>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-red remove_file tiny">close</i></a></div></li>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-red remove_file tiny">close</i></a></div></li>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-red remove_file tiny">close</i></a></div></li>
              </session-error>
            </ul>
          </div>
        </div>

     </div>
     <div class="modal-footer">
       <center>
         <button class="btn-flat postbutton" type='submit' id="post-submit">Post<!--<div class="post2">Post</div>--></button>
       </center>
     </div>
   </div>
    <nav class="nord-darkblue" role="navigation">
      <ul id="profileDropdown" class="dropdown-content">
        <li><a href="/profile/" class="modal-trigger">Profile</a></li>
        <li><a href="/auth/logout" class="modal-trigger">Log out</a></li>
      </ul>
      <div class="nav-wrapper container">
        <a id="logo-container" href="/home/" class="brand-logo"><img src="../images/icon.png" height="50px" width="auto" style="padding-top:5px;" /></a>
        <ul class="right hide-on-med-and-down">
          <li><a href="/home/">Home</a></li>
          <li><a href="/assignments/">Assignments</a></li>
          <li><a class="modal-trigger nord-orange" href="#notificationsModal"><i class="material-icons">notifications</i></a></li>
          <li><a class="dropdown-trigger" href="#!" data-target="profileDropdown"><i class="material-icons">person arrow_drop_down</i></a></li>
        </ul>

        <ul id="nav-mobile" class="sidenav">
          <li><a href="/home/">Home</a></li>
          <li><a href="/assignments/">Assignments</a></li>
          <li><a href="/profile/" class="modal-trigger">Profile</a></li>
          <li><a href="/auth/logout" class="modal-trigger">Log out</a></li>
        </ul>
        <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
      </div>
    </nav>

    <div class="modal" id="notificationsModal">
      <div class="modal-content">
        <center>
          <i class='material-icons nord-orange-text medium'>notifications</i>
        </center>
        <session-error>
          <ul class="collection notification-collection">
          <a href="#">
            <li class="collection-item modal-notification post-notif">
              <img src="../images/default.jpg" class="modal-notif-pfp"/>
              <div>
                <div class="truncate nord-purple-text notif-content">
                  <b>Name</b> posted a <b>thing</b> in <b>class</b>
                </div>
                <div class="truncate">
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                </div>
              </div>
            </li>
          </a>
          <a href="#">
            <li class="collection-item modal-notification assignment-notif">
              <img src="../images/default.jpg" class="modal-notif-pfp"/>
              <div>
                <div class="truncate nord-purple-text notif-content">
                  <b>Teacher</b> posted an <b>assignment</b> in <b>class</b>
                </div>
                <div class="truncate">
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                </div>
              </div>
            </li>
          </a>
          <a href="#">
            <li class="collection-item modal-notification comment-notif">
              <img src="../images/default.jpg" class="modal-notif-pfp"/>
              <div>
                <div class="truncate nord-purple-text notif-content">
                  <b>Name</b> replied to your comment in <b>class</b>
                </div>
                <div class="truncate">
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                </div>
              </div>
            </li>
          </a>
        </ul>
        </session-error>
        <ul class="collection notification-collection" id="notificationsContainer">

        </ul>
      </div>
    </div>


    <div class="container class-header">
      <div class="row">
        <h3>${class}</h3>
        <h5>${teachers}</h5>
        <h6>Class code: <span class="grey-text">${classCode}</span></h6>
        <a href="#" data-target="class_page_menu" class="dropdown-trigger"><i class="right-align material-icons medium class_menu">more_horiz</i></a>
      </div>
    </div>

    <ul class="dropdown-content" id="class_page_menu">
      <!-- <li class="color_list_item">
            <ul class="color-picker">
              <div href="#" class="color nord-lightblue"></div>
              <div href="#" class="color nord-darkblue"></div>
              <div href="#" class="color nord-darkgrey"></div>
              <div href="#" class="color nord-red"></div>
              <div href="#" class="color nord-orange"></div>
              <div href="#" class="color nord-purple"></div>
              <div href="#" class="color nord-yellow"></div>
            </ul>
        </li> -->
          <li class="class_options modal-trigger" href="#leaveModal"><a>Leave class</a></li>
          <teacher-container>
            <li class="warn class_options modal-trigger renameClass" href="#renameModal"><a id="renameClass"><i class="material-icons">edit</i>Rename</a></li>
            <li class="warn class_options modal-trigger deleteClass" href="#deleteModal"><a id="deleteClass"><i class="material-icons">delete</i>Delete class</a></li>
          </teacher-container>
    </ul>

    <div class="modal" id="renameModal">
      <div class="modal-content">
        <center>
          <h4>Rename ${class}</h4>
        </center>
        <div class="form" method="POST" action="/api/class/rename" on-success-reload="true">
          <div class="input_field">
            <input type="text" name="newClassName" id="newGroupName" />
            <label for="newGroupName">Enter new group name</label>
            <input type="hidden" name="classID" value="${classID}">
          </div>
          <br />
          <center>
            <div class="nord-red btn-large modal-close">Cancel</div>
            <button type="submit" name="button" class="btn-large nord-darkblue">Rename</button>
          </center>
        </div>
      </div>
    </div>

    <div class="modal" id="deleteModal">
      <div class="modal-content">
        <center>
          <h4>Are you sure you want to delete ${class}?</h4>
          <h6><i>All data and posts from the group will be lost forever</i></h6>
        </center>
        <br />
        <center>
          <div class="nord-red btn-large modal-close">Cancel</div>
          <div class="btn-large nord-darkblue">Delete</div>
        </center>
      </div>
    </div>

    <div class="modal" id="leaveModal">
      <div class="modal-content">
        <center>
          <h4>Are you sure you want to leave ${class}?</h4>
          <h6><i>You will not be able to access the data and posts in this group unless you rejoin the group.</i></h6>
        </center>
        <br />
        <center>
          <div class="nord-red btn-large modal-close">Cancel</div>
          <div class="btn-large nord-darkblue" id="leaveClass">Leave Group</div>
        </center>
      </div>
    </div>

    <div class="modal" id="kickModal">
      <div class="modal-content">
        <center>
          <h4>Are you sure you want to remove ${student_name} from ${class}?</h4>
          <h6><i>The student will not be able to access the data and posts in this group unless they rejoin the group.</i></h6>
        </center>
        <br />
        <center>
          <div class="nord-darkblue btn-large modal-close">Cancel</div>
          <div class="btn-large nord-red">Remove</div>
        </center>
      </div>
    </div>


    <div class="container">
        <div class="row col s12">
          <div class="col s2">
            <a onclick="activateTab('postsTab','main');"><div class="tab">Posts</div></a>
            <a onclick="activateTab('membersTab','main');"><div class="tab">Members</div></a>
            <a onclick="activateTab('assignmentsTab','main');"><div class="tab">Assignments</div></a>
          </div>
          <div class="tab-container" tab-container-id="main">
            <div class="tab-panel col s8 offset-s1" tab-id="membersTab">
              <h3>Members</h3>
              <hr />
                <ul class="collection" id="membersList">

                  <session-error>
                    <li class="collection-item member_item"><div><a href="/profile/" class="member_name">Member name</a><!--<a href="#kickModal" class="modal-trigger secondary-content"><i class="material-icons remove_student nord-red valign-wrapper">close</i></a>--></div></li>
                    <li class="collection-item member_item"><div><a href="/profile/" class="member_name">Member name</a><!--<a href="#kickModal" class="modal-trigger secondary-content"><i class="material-icons remove_student nord-red valign-wrapper">close</i></a>--></div></li>
                    <li class="collection-item member_item"><div><a href="/profile/" class="member_name">Member name</a><!--<a href="#kickModal" class="modal-trigger secondary-content"><i class="material-icons remove_student nord-red valign-wrapper">close</i></a>--></div></li>
                  </session-error>
                </ul>
            </div>
            <div class="tab-panel activeTab col offset-s1 s8" tab-id="postsTab">
              <!-- <div class="col offset-s1 s8"> -->
          <h2>Posts</h2>
          <hr />
          <!-- <br /> -->
          <a href="#post" class="modal-trigger"><div class="post-btn btn"><center><b class="valign-wrapper"><i class="material-icons small">mode_edit</i>CREATE A POST</b></center></div></a>
          <br />
          <br />
        <!-- </div> -->
        <div>
          <div class="" id="postContainer">
            <div class="post hoverable hidden" id="samplePost">
              <div class="post-header">
                <img class="post-pfp" src="../images/default.jpg" />
              </div>
              <div class="poster">Kabir De Sarkar<a href="#" class="dropdown-trigger" data-target="post-dropdown"><i class="material-icons post-options">more_horiz</i></a></div>
              <a href="#" class="post-class">IBDP1 Chemistry</a>
              <span class="date-text">3:45PM, Wednesday, October 15th, 2019</span>
              <div class="more">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
              <ul class="collection files">
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-purple download_file tiny">file_download</i></a></div></li>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-purple download_file tiny">file_download</i></a></div></li>
                <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-purple download_file tiny">file_download</i></a></div></li>
              </ul>              <hr />
              <h6><b>Comments</b></h6>
              <div class="form">
                <input name="comment" type="text" class="comment-input"/>
                <button name="comment-btn" type="submit" name="button" class="right-align btn nord-red">Comment</button>
                <br /><br />
              </div>
              <div class="comments">
                <div class="comment">
                  <div class="comment-marker nord-darkblue"></div>
                  <img class="comment-pfp" src="../images/default.jpg"/>
                  <div class="comment-poster">Kabir</div><span class="date-text">3:45PM, Wednesday, October 15th, 2019</span>
                  <div class="comment-text more">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
                </div>
              </div>
              <div class="load-more-comments">
                <a href="/post/">[Load more comments...]</a>
              </div>
            </div>
          </div>
        </div>
            </div>

            <div class="modal" id="assignmentModal" on-student-remove>
              <div class="modal-content">
                <center>
                  <h2>Create an assignment</h2>
                </center>
                <div>
                  <form id="createAssignmentForm">
                    <div class="input-field col s12">
                      <input type="text"id="assignment_title" name="title" value="" placeholder="Enter title" required>
                      <label for="assignment_title">Assignment title</label>
                    </div>
                    <div class="input-field col s12">
                      <textarea id="icon_prefix2" class="materialize-textarea" name="content" placeholder="Enter Content of post" required></textarea>
                      <label for="icon_prefix2">Content</label>
                    </div>
                  </form>
                  <label for="due_date">Due date</label>
                  <input type="text" class="datepicker" id="due_date" required readonly>
                  <div class="row">
                      <a class="btn nord-red">
                        <span class="valign-wrapper" id="createAssignmentAttachButton"><i class="material-icons">attach_file</i>Attach file</span>
                        <input type="file" class="hidden" multiple id="createAssignmentAttachments">
                      </a>
                  </div>
                  <ul id="createAssignmentFileContainer" class="collection files">
                    <session-error>
                      <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-purple download_file tiny">file_download</i></a></div></li>
                      <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-purple download_file tiny">file_download</i></a></div></li>
                      <li class="collection-item" class="file"><div><a href="#">file_name.mp3</a><a href="#" class="secondary-content"><i class="white material-icons nord-purple download_file tiny">file_download</i></a></div></li>
                    </session-error>
                  </ul>
                </div>
                <center>
                  <h6 class='nord-red' id="createAssignmentError"></h6>
                  <div class="btn-large modal-close nord-red">Cancel</div>
                  <button type="submit" class="btn-large nord-darkblue" id="createAssignmentSubmit">Post</button>
                </center>
              </div>

            </div>

            <div class="tab-panel col s9 offset-s1" tab-id="assignmentsTab">
              <h3>Assignments</h3>
              <hr />
              <a on-student-remove href="#assignmentModal" class="modal-trigger"><div class="assignment-btn btn"><center><b class="valign-wrapper"><i class="material-icons small">mode_edit</i>CREATE AN ASSIGNMENT</b></center></div></a>
                <div>
                  <div class="row hidden" id="allAssignments">
                    <h4>All</h4>
                    <hr />
                  </div>
                  <div class="row" id="allAssignmentsContainer">

                    <session-error>
                      <div class="col s3 assignment-item">
                        <div class="assignment-content">
                          <div class="assignment-name">Math stuff</div>
                          <div class="assignment-subject">Math</div>
                          <div class="due">Due Wednesday<br>October 16, 2019</div>
                          <center><div class="submitted btn submit">Submitted</div></center>
                        </div>
                      </div>


                      <div class="col s3 assignment-item">
                        <div class="assignment-content">
                          <div class="assignment-name">Chemistry stuff</div>
                          <div class="assignment-subject">Chemistry</div>
                          <div class="due">Due Tomorrow<br>October 15, 2019</div>
                          <center><div class="not-submitted btn submit"><div id="submit">Not Submitted</div></div></center>
                        </div>
                      </div>
                    </session-error>
                </div>

                <br>
                <br>

                <div class="row hidden" id="dueAssignments">
                  <h4>Due Soon</h4>
                  <hr />
                </div>
                  <div class="row" id="dueAssignmentsContainer">
                    <session-error>
                    <div class="col s3 assignment-item">
                      <div class="assignment-content">
                        <div class="assignment-name">Chemistry stuff</div>
                        <div class="assignment-subject">Chemistry</div>
                        <div class="due">Due Tomorrow<br>October 15, 2019</div>
                        <center><div class="not-submitted btn submit"><div id="submit">Not Submitted</div></div></center>
                      </div>
                    </div>
                  </session-error>
                  </div>

                <br>
                <br>

                <div class="row hidden" id="submittedAssignments">
                  <h4>Submitted</h4>
                  <hr />
                </div>
                <div class="row" id="submittedAssignmentsContainer">
                  <session-error>
                    <div class="col s3 assignment-item">
                      <div class="assignment-content">
                        <div class="assignment-name">Math stuff</div>
                        <div class="assignment-subject">Math</div>
                        <div class="due">Due Wednesday<br>October 16, 2019</div>
                        <center><div class="submitted btn submit">Submitted</div></center>
                      </div>
                    </div>
                  </session-error>
                </div>



              </div>
            </div>
          </div>
        </div>
    </div>
    <!-- /////////////////////////////////////////////////////// -->
    <script type="text/javascript" src="../js/angular.min.js"></script>
    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/materialize.js"></script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>
    <script type="text/javascript" src="../js/initializing.js"></script>
    <script type="text/javascript" src="../js/script.js"></script>
    <script type="text/javascript" src="../js/events.js"></script>
    <!-- /////////////////////////////////////////////////////// -->
    <script>
      /*$('div.color').click(function(){
        var classColor = this.className;
        alert(classColor);
        }
      )*/
      $.initSession();
      $('#leaveClass').on("click",(event) => {
        $.ajax({
          url:"/api/class/leave",
          type:"POST",
          data:{classID:$.getResourceID()},
          success:function(e){
            window.location.href = "/home"
          }, error:function(e){
            alert("Error occured in operation")
            console.log(e)
          }
        })
      })
      $('#deleteClass').on("click",(event) => {
        $.ajax({
          url:"/api/class/disband",
          type:"POST",
          data:{classID:$.getResourceID()},
          success:function(response){
            window.location.href = "/home"
          }, error:function(error){
            alert("Error occured in operation");
            console.log(error)
          }
        })
      })
      function activateTab(tabId){
        let mainElem = $(`[tab-id=${tabId}]`);
        mainElem.parent().children(".activeTab").removeClass('activeTab');
        mainElem.addClass('activeTab')
      }

      $(window).on('sessionLoaded',(event,error,sessionData) => {
        let currentClass = $.getResourceID()
        // console.log(currentClass)
        $.ajax({
          url:"/api/assignments/list",
          type:'POST',
          data:{classID:currentClass},
          success:function(data){
            // console.log(data)
            let allAssignments = $('#allAssignments');
            let dueAssignments = $('#dueAssignments');
            let submittedAssignments = $('#submittedAssignments');
            let allAssignmentsContainer = $('#allAssignmentsContainer');
            let dueAssignmentsContainer = $('#dueAssignmentsContainer');
            let submittedAssignmentsContainer = $('#submittedAssignmentsContainer');
            let submissionsRequired = duesRequired = false;
            if(data.length != 0) {
              allAssignments.removeClass('hidden');
            } else $('#assignmentsPrompt').removeClass('hidden')
            for(let assignment of data){
              let {dueDate,id,content,title,attachments,status,className} = assignment;
              dueDate = new Date(Number(dueDate));
              let submittedBoolean = (status != 'due');
              let isSubmitted = submittedBoolean ? '' : 'not-';
              // console.log(allAssignmentsContainer)
              let isLockedText = (assignment.locked && !submittedBoolean) ? 'locked':"";
              isSubmittedText = "";
              if(sessionData.type == 'student') {
                if(submittedBoolean) isSubmittedText = "Submitted"
                else if(assignment.locked) isSubmittedText = "LOCKED"
                else isSubmittedText = 'due'
              }
              else isSubmittedText = 'VIEW'
              let elemString = `
                <div class="col s3 assignment-item">
                  <div class="assignment-content">
                    <div class="assignment-name">${title}</div>
                    <div class="assignment-subject">${className}</div>
                    <div class="due">Due ${dueDate.getDayName()}<br>${dueDate.getMonthName()} ${dueDate.getDate()}, ${dueDate.getFullYear()}</div>
                    <center><div onclick="window.location.href = '/assignment/${id}'" class="${isSubmitted}submitted ${isLockedText} btn submit">${isSubmittedText}</div></center>
                  </div>
                </div>
                `
              allAssignmentsContainer.append($(elemString));
              if(sessionData.type == 'student'){
                if (!submittedBoolean) {
                  dueAssignmentsContainer.append($(elemString))
                  if(!duesRequired) duesRequired = true
                }
                else {
                  submittedAssignmentsContainer.append($(elemString))
                  if(!submissionsRequired) submissionsRequired = true
                }
              }
            }
            if(duesRequired) dueAssignments.removeClass('hidden')
            if(submissionsRequired) submittedAssignments.removeClass('hidden')
          },error:function(err){
            console.error(err)
          }
        })
        $.ajax({
        url:"/api/post/list",
        type:"POST",
        data:{classID:$.getResourceID()},
        success:function(response){
          // console.log(response)
          let postContainer = $('#postContainer');
          $('#samplePost').addClass('hidden')
          // for(let post of response){
          //   let {classID,className,content,title,posterName,dateCreated} = post;
          //   dateCreated = new Date(dateCreated).getSemiSimpleTime();
          //
          //   let elem = $(`<div class="post">
          //     <a href="/class/${classID}" class="assignment-subject bold-text blue-text">${className}</a>
          //     <h5>${title}</h5>
          //     <h7>${posterName}</h7><br>
          //     <span class="grey-text small-text">${dateCreated}</span>
          //     <h6>${content}</h6>
          //   </div>`)
          //   postContainer.append(elem)
          // }
          // response = response.reverse();
          // let dropDownHTML = ""
          /*for(let post of response){
            let {classID,className,content,title,posterName,dateCreated,poster} = post;
            let postID = post.id;
            let posterType = post.posterType;
            dateCreated = new Date(dateCreated).getSemiSimpleTime();
            let ifTeacherAccountAddElementHere = (posterType == 'teacher') ? '<a class="tooltipped" data-posiion="left" data-tooltip="Teacher"><i class="material-icons nord-yellow-text">school</i></a>' : ''
            comments = "";
            let isOwnerOfPost = (poster==sessionData.id)
            // let dropDownTextEditable = (isOwnerOfPost) ? `<li class="modal-trigger edit-post-modal-trigger" href="#editModal" post-id="${postID}"><a>Edit Post</a></li>
            // <li class="warn modal-trigger delete-post-modal-trigger" href="#deletePostModal" post-id="${postID}"><a>Delete Post</a></li>` : ""
            // dropDownHTML += `<ul class="dropdown-content" id="post-dropdown-${postID}">
            //   <li><a href="/post/${postID}">Go to post</a></li>
            //   ${dropDownTextEditable}
            // </ul>`
            if(post.comments.length > 0){
              let amount = (post.comments.length>3)? 3:post.comments.length
              for(let i=0;i<amount;i++){
                let comment = post.comments[i]
                let {id,dateCreated,commenter,commenterName,content} = comment;
                let isOwnerOfComment = (commenter==sessionData.id);
                let dateCommented = new Date(dateCreated).getSemiSimpleTime()
                comments+=`<div class="comment">
                <div class="comment-marker nord-darkblue"></div>
                <img class="comment-pfp" src="/api/users/${commenter}/image"/>
                <div class="comment-poster"><a href="/user/${commenter}">${commenterName}</a></div><span class="date-text">${dateCommented}
                ${(isOwnerOfComment)?
                  `
                  <span class="date-text small-side-margin edit-comment pointer-cursor" post-id="${id}"><a>Edit  </a></span>
                  <span class="date-text modal-trigger small-side-margin delete-comment pointer-cursor" comment-id="${id}" href="#deleteCommentModal"><a>Delete</a></span>
                  `:""
                }
                </span>
                <!-- <div class="comment-text more">${content}</div> -->
                ${(isOwnerOfComment)?
                  `
                  <div class="form comment-edit-form" action="/api/post/comment/edit" method="POST">
                    <input type="hidden" name="commentID" value="${id}">
                    <textarea class="materialize-textarea comment-readonly" readonly name="content">${content}</textarea>
                    <div class="hidden">
                    <button class="btn nord-red" type="submit">SAVE CHANGES</button>
                    <button class="btn nord-blue comment-edit-cancel-button">CANCEL</button>
                    </div>
                  </div>
                  `
                  :
                  `
                  <textarea class="materialize-textarea comment-readonly" readonly>${content}</textarea>
                  `
                }
                </div>`
              }
            }
            let attachmentContent = ""
            post.attachments = post.attachments || []
            for(let attachment of post.attachments){
              attachmentContent+=
              // `<a href="/class/${classID}/attachment/${attachment.fileName}"><i class="tiny material-icons">attach_file</i> ${attachment.originalName}</a><br>`
              `
                <li class="collection-item file"><div><a href="/class/${post.classID}/attachment/${attachment.fileName}">${attachment.originalName}</a><a download href="/class/${post.classID}/attachment/${attachment.fileName}" class="secondary-content"><i class="white material-icons nord-purple download_file tiny">file_download</i></a></div></li>
              `
            }
            let loadMoreContainer = (post.comments.length > 3) ? `<div class="load-more-comments">
              <a href="/post/${postID}">[Load more comments...]</a>
            </div>` : ''
            let elem = $(`<div class="post hoverable">
              <div class="post-header">
                <img class="post-pfp" src="/api/users/${poster}/image" />
              </div>
              <!--
              <a post-id="${postID}" owner="${isOwnerOfPost}" class="dropdown-trigger" data-target="post-dropdown-${postID}"><i class="material-icons post-options">more_horiz</i></a>
              -->
              <div class="poster"><a href="/user/${poster}">${posterName}</a><div>
              ${ifTeacherAccountAddElementHere}
              <span class="date-text">${dateCreated}  ${(post.dateCreated != post.lastModified) ? '(Edited)' : ''}</span>
              <span class="date-text small-side-margins pointer-cursor"><a href="/post/${postID}">Go to post  </a></span>
              ${(isOwnerOfPost)?
              `
              <span class="date-text modal-trigger pointer small-side-margin edit-post pointer-cursor" post-id="${postID}" href="#editModal"><a>Edit  </a></span>
              <span class="date-text modal-trigger small-side-margin delete-post pointer-cursor" post-id="${postID}" href="#deletePostModal"><a>Delete</a></span>

              `:""
              }
              <div class="more content-of-post">${content}</div>
              <ul class="collection files">
              ${attachmentContent}
              </ul>
              <hr />
              <h6><b>Comments</b></h6>
              <div class="form comment-form" method='POST' action="/api/post/comment/create?json=true"  on-error="console.log(response)">

                <input name="postID" type="text" value="${postID}" class="hidden comment-input"/>
                <input name="content" type="text" class="comment-input" placeholder="Comment here..."/><br>
                <button name="comment-btn" type="submit" name="button" class="right-align btn nord-red">Comment</button>
                <br /><br />
              </div>
              <div class="comments">
                ${comments}
              </div>
              ${loadMoreContainer}
            </div>
            </div>`)
            postContainer.append(elem)
          }*/
          for(let post of response){
            $.genPost(post,postContainer,sessionData,{comments:true})
            console.log(post)
          }
          if(response.length == 0){
            postContainer.append($(`<center><h6 class="grey-text">No posts to be loaded</h6></center>`))
          }
          try {
            $('.dropdown-trigger').dropdown();
          } catch (e) {
            console.warn("Dropdowns are not working, great")
          } finally {

          }
          // $('#dropdown-container').html(dropDownHTML);
          $('#deleteProxy').on('click',() => {
            $('#deleteClass').click()
            // l('sdlkfjdsiklfj')
          })
          $('.delete-post').on('click',function() {
            let elem = $(this);
            let parentPost = elem.parents('.post').eq(0);
            // l("lsdkjfldsjkf"+elem.attr("post-id"))
            $('#deletePostId').val(elem.attr("post-id"))
          })
          $('.edit-post').on('click',function(){
            let elem = $(this);
            let parentPost = elem.parents('.post').eq(0);
            let editPostContent = parentPost.find(".content-of-post");
            // l(editPostContent)
            // l(elem.attr('post-id'))
            $('#edit-old-file-container').html('')
            $('#edit-new-file-container').html('')
            $('#editPostContent').val(editPostContent.text())
            $('#edit-postID').val(elem.attr('post-id'))
            $('#edit-postID').trigger("fetchready",[elem.attr('post-id')])
          })
          $('.edit-comment').on('click',function(){
            let elem = $(this);
            let form = elem.parents(".comment").eq(0).find(".comment-edit-form");
            // l(form)
            let textarea = form.find('[name=content]')
            let hiddenDiv = form.find("div.hidden")
            hiddenDiv.removeClass('hidden');
            textarea.removeAttr("readonly");
            textarea.focus()
            textarea.attr("initial-value",textarea.val())
            elem.addClass('hidden');
            form.find('.comment-edit-cancel-button').eq(0).off("click")
            form.find('.comment-edit-cancel-button').eq(0).on("click",function(){
              textarea.val(textarea.attr("initial-value"));
              hiddenDiv.addClass('hidden');
              elem.removeClass('hidden')
            })
            form.on('success',function(){
              hiddenDiv.addClass("hidden");
              textarea.attr("readonly","")
              textarea.attr("initial-value",textarea.val());
              elem.removeClass('hidden')
            })
            form.on('error',function(event,err){
              l(err)
            })
          })
          $('.delete-comment').on("click",function(){
            let elem = $(this);
            $('#deleteCommentId').attr("value",elem.attr('comment-id'))
          })
          $('#post-attach-files-button').on('click',() => {
            $('#post-files').click()
            // l('why is this a thing')
          })
          $('#writePostButton').on('click',function(){
            $('#post-files')[0].fileList = [];
            $('#post-file-collection').html("")
          })
          $('#post-files').on('change',function(){
            let elem = $(this)[0];
            elem.fileList = elem.fileList || [];
            for(let file of elem.files) {
              $('#post-file-collection').append(
                $(
                  `<li class="collection-item" class="file"><div><a href="#">${file.name}</a><a href="#" class="secondary-content"><i  file-name="${file.name}" class="white post-remove-file material-icons nord-red remove_file tiny">close</i></a></div></li>`
                )
              )
              $('#post .post-remove-file').off('click')
              $('#post .post-remove-file').on('click',function(){
                // l($(this).parents(".collection-item").eq(0))
                for(let i=0;i<elem.fileList.length;i++) {
                  let file = elem.fileList[i];
                  if(file.name == $(this).attr('file-name')) elem.fileList.splice(i,1)
                }
                $(this).parents(".collection-item").eq(0).remove();
                l(elem.fileList)
              })
              elem.fileList.push(file)
            }
          })
          $('#post-submit').on("click",() => {
            let classID = $.getResourceID()
            let content = $('#post-content').val();
            let validationMessage = ""
            if(content.trim().length < 6) {
              validationMessage += "Min content length has to be more than 6<br>"
            } else {
              let postFiles = $('#post-files');
              let formData = new FormData();
              formData.append("classID",classID);
              formData.append("content",content);
              postFiles[0].fileList = postFiles[0].fileList || []
              for(let file of postFiles[0].fileList) formData.append("additionalFiles",new Blob([file]),file.name)
              $.ajax({
                url:"/api/post/create?uploadingFile=true",
                type:"POST",
                data:formData,
                processData:false,
                contentType:false,
                cache:false,
                success:function(data){
                  console.log(data);
                  window.location.reload(true)
                },error:function(err){
                  // console.log(err)
                  $('#post-error').text(err)
                }
              })
            }
            $("#post-error").html(validationMessage)
          })
          // $('.post-dropdown-button').on('click',function() {
          //   let elem = $(this);
          //   $('#dropdownPostLink a').attr('href',`/post/${elem.attr("post-id")}`)
          //   if(elem.attr("owner") == 'true') {
          //     // $('#hiddenDropdown').removeClass('hidden')
          //     $('#editPostButton').removeClass('hidden')
          //     $('#deletePostButton').removeClass('hidden')
          //   }
          //   else {
          //     $('#editPostButton').addClass('hidden')
          //     $('#deletePostButton').addClass('hidden')
          //     // $('#hiddenDropdown').addClass('hidden')
          //   }
          // })
          initForms()
          $('.comment-form').on("success", function(event,response){
            let elem = $(this);
            let commentID = response.comment.id
            let commentInput = elem.children(`.comment-input`).eq(1);
            let commentValue = commentInput.val()
            let user = sessionStorage.getItem("user")
            // l(elem.parent().children(".comments").eq(0));
            let commentElem = elem.parent().children('.comments').eq(0);
            let comment = $(`
              <div class="comment">
                <div class="comment-marker nord-darkblue"></div>
                <img class="comment-pfp" src="/api/users/${sessionData.id}/image"/>
                <div class="comment-poster">${user}</div><span class="date-text">${new Date().getSemiSimpleTime()}</span>
                <span class="date-text small-side-margin edit-comment pointer-cursor"><a>Edit  </a></span>
                <span class="date-text modal-trigger small-side-margin delete-comment pointer-cursor" comment-id="${commentID}" href="#deleteCommentModal"><a>Delete</a></span>
                <div class="form comment-edit-form" action="/api/post/comment/edit" method="POST">
                  <input type="hidden" name="commentID" value="${commentID}">
                  <textarea class="materialize-textarea comment-readonly" readonly name="content">${commentValue}</textarea>
                  <div class="hidden">
                  <button class="btn nord-red" type="submit">SAVE CHANGES</button>
                  <button class="btn nord-blue comment-edit-cancel-button">CANCEL</button>
                  </div>
                </div>
              </div>
            `)
            commentElem.append(comment);
            commentInput.val("")
            $('.delete-comment').off('click')
            $('.edit-comment').off('click');
            $('.edit-comment').on('click',function(){
              let elem = $(this);
              let form = elem.parents(".comment").eq(0).find(".comment-edit-form");
              // l(form)
              let textarea = form.find('[name=content]')
              let hiddenDiv = form.find("div.hidden")
              hiddenDiv.removeClass('hidden');
              textarea.removeAttr("readonly");
              textarea.attr("initial-value",textarea.val())
              elem.addClass('hidden');
              form.find('.comment-edit-cancel-button').eq(0).off("click")
              form.find('.comment-edit-cancel-button').eq(0).on("click",function(){
                textarea.val(textarea.attr("initial-value"));
                hiddenDiv.addClass('hidden');
                elem.removeClass('hidden')
              })
              form.on('success',function(){
                hiddenDiv.addClass("hidden");
                textarea.attr("readonly","")
                textarea.attr("initial-value",textarea.val());
                elem.removeClass('hidden')
              })
              form.on('error',function(event,err){
                l(err)
              })
            })
            $('.delete-comment').on("click",function(){
              let elem = $(this);
              $('#deleteCommentId').attr("value",elem.attr('comment-id'))
            })
          })

        }, error:function(error){
          $('#samplePost').removeClass("hidden")
          console.error(error.responseText)
        }
      })
      })
      $.ajax({
        url:"/api/class/"+$.getResourceID()+"/list/members",
        success:function(data){
          // console.log(data)
          for(let person of data){
            $('#membersList').append(
              $(
                `<li class="collection-item member_item"><div><a href="/profile/" class="member_name">${person.username}</a><!--<a href="#kickModal" class="modal-trigger secondary-content"><i class="material-icons remove_student nord-red valign-wrapper">close</i></a>--></div></li>`
              )
            )
          }
        },error:function(err){
          console.log(err)
        }
      })
      // FILE UPLOAD FOR EDITING
      $('#edit-postID').on("fetchready",(event,postID) => {
        $.ajax({
          url:"/api/post/get/"+postID,
          type:"GET",
          success:function(response){
            // l(response)
            let {attachments} = response;
            $('#edit-old-file-container').html('')
            for(let attachment of attachments){
              $('#edit-old-file-container').append(
                $(
                  `<li class="collection-item" class="file"><div><a href="#">${attachment.originalName}</a><a class="secondary-content"><i  file-name="${attachment.originalName}" file-id="${attachment.fileName}" class="white edit-remove-file material-icons nord-red remove_file tiny">close</i></a></div></li>`
                )
              )
            }
            $('#edit-old-file-container .edit-remove-file').on('click',function(){
              let elem = $(this);
              let originalName = elem.attr("file-name");
              let fileName = elem.attr("file-id");
              $("#edit-attach-file")[0].removedFiles = $("#edit-attach-file")[0].removedFiles || [];
              $("#edit-attach-file")[0].removedFiles.push({fileName,originalName})
              elem.parents(".collection-item").eq(0).remove()
              // l($("#edit-attach-file")[0].removedFiles)
            })

          }
        })
      })
      $('#edit-attach-file-button').on('click',() => {
        $('#edit-attach-file').click()
      })
      $('#edit-attach-file').on('change',() => {
        let elem = $('#edit-attach-file')[0];
        elem.fileList = elem.fileList || [];
        for(let file of elem.files){
          elem.fileList.push(file);
          $('#edit-new-file-container').append(
            $(
              `<li class="collection-item" class="file"><div><a href="#">${file.name}</a><a class="secondary-content"><i  file-name="${file.name}" class="white edit-remove-file material-icons nord-red remove_file tiny">close</i></a></div></li>`
            )
          )
        }
        $('#edit-new-file-container .edit-remove-file').off('click')
        $('#edit-new-file-container .edit-remove-file').on('click',function() {
          let button = $(this)
          for (let i = 0; i < elem.fileList.length; i++) {
            let file = elem.fileList[i];
            if(file.name == button.attr("file-name")) elem.fileList.splice(i,1)
          }
          button.parents('.collection-item').eq(0).remove()
          l(elem.fileList)
        })
      })
      $('#edit-submit').on('click',() => {
        let postID = $('#edit-postID').val();
        let content = $('#editPostContent').val();
        let fileUpload = $('#edit-attach-file')[0]
        fileUpload.removedFiles = fileUpload.removedFiles || []
        fileUpload.fileList = fileUpload.fileList || []
        let formData = new FormData();
        formData.append("postID",postID);
        formData.append("content",content);
        for(let removedFile of fileUpload.removedFiles){
          formData.append('removedFiles',JSON.stringify(removedFile))
        }
        for(let addedFile of fileUpload.fileList){
          formData.append('additionalFiles',new Blob([addedFile]),addedFile.name)
        }
        $.ajax({
            url:"/api/post/edit?json=true&postFiles=true",
            type:"POST",
            data:formData,
            contentType:false,
            processData:false,
            cache:false,
            success:function(data){
              window.location.reload(true)
            },error:function(data){
              console.error(data)
            }
          })
      })


      // FILE UPLOAD FOR POSTING
      // function show(){
      //   if this.hasClass("class_members"){
      //     this.css("visibility", "visible");
      //     $('.class_posts').css("visibility", "hidden");
      //     $('.class_assignments').css("visibility", "hidden");
      //   }
      //
      //   else if this.hasClass("class_posts"){
      //     this.css("visibility", "visible");
      //     $('.class_members').css("visibility", "hidden");
      //     $('.class_assignments').css("visibility", "hidden");
      //   }
      //
      //   else if this.hasClass("class_assignments"){
      //     this.css("visibility", "visible");
      //     $('.class_posts').css("visibility", "hidden");
      //     $('.class_members').css("visibility", "hidden");
      //   }
      // }

      // $(".renameModal").on("click", function(){
      //   var instance = M.Modal.getInstance("#renameModal");
      //   instance.open();
      // })
      let chooseFiles = $('#createAssignmentAttachments')[0];
      chooseFiles.removedFiles = chooseFiles.removedFiles || []
      chooseFiles.additionalFiles = chooseFiles.additionalFiles || []
      $('#createAssignmentAttachButton').on('click',() => {
        $(chooseFiles).click()
      })
      $(chooseFiles).on('change',() => {
        for(let file of chooseFiles.files){
          let elem = $(`
            <li class="collection-item" class="file"><div><a>${file.name}</a><a class="secondary-content"><i class="white material-icons nord-red download_file tiny cross" file-name="${file.name}">delete</i></a></div></li>
            `)
          $('#createAssignmentFileContainer').append(elem)
          chooseFiles.additionalFiles.push(file)
        }
        $('#createAssignmentFileContainer .cross').off('click')
        $('#createAssignmentFileContainer .cross').on('click',function(){
          let elem = $(this)
          console.log("tests")
          let fileName = elem.attr('file-name');
          for(let i=0;i<chooseFiles.additionalFiles.length;i++){
            if(chooseFiles.additionalFiles[i].name == fileName) {
              // console.log('yes?')
              chooseFiles.additionalFiles.splice(i,1)
            }
          }
          elem.parents(".collection-item").eq(0).remove()
        })
      })
      $('#createAssignmentSubmit').on('click',() => {
        let formData = new FormData($('#createAssignmentForm')[0]);
        for(let input of $('#assignmentModal [required]')) if($(input).val().trim() == '' && $(input).next().attr('class') != 'red-text') $(input).after($('<span class="red-text">This field is required</span>'))
        for(let input of $('#assignmentModal [required]')) if($(input).val().trim() != '' && $(input).next().attr('class')=='red-text') $(input).next().remove()
        formData.append('dueDate',new Date($('#due_date').val()).getTime())
        let classID = $.getResourceID();
        console.log(classID)
        formData.append('classID',classID)
        for(let file of chooseFiles.additionalFiles) formData.append("additionalFiles",new Blob([file]),file.name);
        // console.log(classID)
        // console.log(formData.get('dueDate'))
        // console.log()
        // for(let item of formData.entries()) console.log(item)
        $.ajax({
          url:"/api/assignments/create?uploadingFiles=true&json=true",
          type:'POST',
          data:formData,
          processData:false,
          cache:false,
          contentType:false,
          success:function(data) {
            // console.log(data)
            window.location.href = `/assignment/${data.id}`
          },error:function(err){
            console.error(err.responseText)
          }
        })
      })
      $(document).ready(function(){
        $('.datepicker').datepicker();
      });

    </script>

  </body>
</html>
