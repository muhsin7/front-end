<!DOCTYPE html>
<html>
  <head>
    <!-- /////////////////////////////////////////////////////// -->
    <link rel="stylesheet" href="../css/icons.css">
    <link rel="stylesheet" href="../css/materialize.css">
    <link rel="stylesheet" href="../css/materialize.css">
    <link rel="stylesheet" href="../css/nord-colours.css">
    <link rel="stylesheet" href="../css/styles.css">
    <!-- /////////////////////////////////////////////////////// -->

  </head>
  <body>

    <nav class="nord-darkblue" role="navigation">
      <ul id="profileDropdown" class="dropdown-content">
        <li><a href="/profile/" class="modal-trigger">Profile</a></li>
        <li><a href="/auth/logout" class="modal-trigger">Log out</a></li>
      </ul>
      <div class="nav-wrapper container">
        <a id="logo-container" href="/home/" class="brand-logo"><img src="../images/cisco.png" height="50px" width="auto" style="padding-top:5px;" /></a>
        <ul class="right hide-on-med-and-down">
          <li><a href="/home/">Home</a></li>
          <li><a href="/assignments/">Assignments</a></li>
          <li><a class="dropdown-trigger" href="#!" data-target="profileDropdown"><i class="material-icons">person arrow_drop_down</i></a></li>
        </ul>

        <ul id="nav-mobile" class="sidenav">
          <li><a href="/home/">Home</a></li>
          <li><a href="/assignments/">Assignments</a></li>
          <li><a href="/profile/" class="modal-trigger">Profile</a></li>
          <li><a href="/auth/logout" class="modal-trigger">Log out</a></li>
        </ul>
        <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
      </div>
    </nav>
    <br /><br />



    <div>
      <ul class="dropdown-content" id="post-dropdown">
        <li class="modal-trigger" href="#editModal" id="editPostButton"><a>Edit Post</a></li>
        <li class="warn modal-trigger" href="#deletePostModal" id="deletePostButton"><a>Delete Post</a></li>
      </ul>

      <div class="modal" id="editModal">
        <div class="modal-content">
          <div class="form" method="POST" action="/api/post/edit" on-error-prompt-selector=".red" on-error="console.log(response)" id="editForm">
            <h5>Edit post</h5>
            <div class="input-field">
              <i class="material-icons prefix">mode_edit</i>
              <input type="text" class='hidden' readonly name="postID" value="${postID}">
              <textarea required class="materialize-textarea" name="content" id="editPostContent"></textarea><br>
              <span class="red"></span>
            </div>
            <button type="submit" name="button" class="btn-large nord-darkblue">Save</button>
            <div class="btn-large nord-red modal-close" id="editCancel">Cancel</div>
          </div>
        </div>
      </div>

      <div class="modal" id="deletePostModal">
        <div class="modal-content">
          <center>
            <h5>Are you sure you want to delete this post?</h5>
            <br />
            <div class="form" action="/api/post/delete" method="POST" on-error-prompt-selector=".red" on-error="console.log(response)" on-success-redirect="/home">
              <input type="text" name="postID" value="${postID}" class="hidden">
              <span class="red"></span><br>
              <button class="btn-large nord-red" type="submit">Delete post</button>
              <div class="btn-large nord-darkblue modal-close">Cancel</div>
            </div>
          </center>
        </div>
      </div>

    </div>



    <div class="container col offset-s1 s8">
      <div class="row" id="postContainer">
        <div class="post hoverable" id="samplePost">
          <div class="post-header">
            <img class="post-pfp" src="../images/default.jpg" />
          </div>
          <div class="poster">${user}<a href="#" class="dropdown-trigger hidden show-if-owner" data-target="post-dropdown"><i class="material-icons post-options">more_horiz</i></a></div>
          <a href="/class/${classID}" class="post-class">${class}</a>
          <span class="date-text">${dateCreated}</span>
          <div class="more" id="contentOfPost">${content}</div>
          <a href="#"><i class="tiny material-icons">attach_file</i> attached_file.png</a>
          <hr />
          <h6><b>Comments</b></h6>
          <div class="form comment-form" method='POST' action="/api/post/comment/create" on-success-reload="true" on-error="console.log(response)">

          <input name="postID" type="text" value="${postID}" class="hidden comment-input"/>
            <input name="content" type="text" class="comment-input" placeholder="Comment here..."/>
            <button name="comment-btn" type="submit" name="button" class="right-align btn nord-red">Comment</button>
            <br /><br />
          </div>
          <div class="comments">
            <div id="commentContainer">

            </div>
            <div class="hidden" id="sampleContainer">
              <div class="comment">
                <div class="comment-marker nord-darkblue"></div>
                <img class="comment-pfp" src="../images/default.jpg"/>
                <div class="comment-poster">Kabir</div><span class="date-text">3:45PM, Wednesday, October 15th, 2019</span>
                <div class="comment-text more">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
              </div>
              <div class="comment">
                <div class="comment-marker nord-darkblue"></div>
                <img class="comment-pfp" src="../images/default.jpg"/>
                <div class="comment-poster">Kabir</div><span class="date-text">3:45PM, Wednesday, October 15th, 2019</span>
                <div class="comment-text more">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
              </div>
              <div class="comment">
                <div class="comment-marker nord-darkblue"></div>
                <img class="comment-pfp" src="../images/default.jpg"/>
                <div class="comment-poster">Kabir</div><span class="date-text">3:45PM, Wednesday, October 15th, 2019</span>
                <div class="comment-text more">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
              </div>
              <div class="load-more-comments">
                <a href="/post/">[Load more comments...]</a>
              </div>
            </div>
            </div>
        </div>
      </div>
    </div>


    <!-- /////////////////////////////////////////////////////// -->
    <script type="text/javascript" src="../js/angular.min.js"></script>
    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/materialize.js"></script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>
    <script type="text/javascript" src="../js/initializing.js"></script>
    <script type="text/javascript" src="../js/script.js"></script>
    <script type="text/javascript" src="../js/events.js"></script>
    <backend-data key="classID">${classID}</backend-data>
    <!-- /////////////////////////////////////////////////////// -->
    <script type="text/javascript">
      $.initSession();
      // $(window).on("sessionLoaded",(event,error,response) => {
      //   l(response)
      // })
      $(window).on("sessionLoaded",(event,error,sessionData) => {
        $.ajax({
        url:"/api/post/list",
        type:'POST',
        data:{classID:$.getDataValue("classID")},
        success:function(data){
          data = data.filter((e) => {
            let id = splitUrl().lastElem();
            id = id.substring(0,((id.indexOf("#")>0)?id.indexOf("#"):id.length))
            return e.id==id
          })[0]
          if(data.poster == sessionData.id) {
            $('.delete-if-not-owner').remove()
            $('.show-if-owner').removeClass('hidden')
          }
          let commentsList = data.comments;
          let comments = ""
          for (let comment of commentsList) {
            let {id,dateCreated,commenter,commenterName,content} = comment;
            let contentContent= content;
            let dateCommented = new Date(dateCreated).getSemiSimpleTime()
            comments+=`<div class="comment">
            <div class="comment-marker nord-darkblue"></div>
            <img class="comment-pfp" src="../images/default.jpg"/>
            <div class="comment-poster">${commenterName}</div><span class="date-text">${dateCommented}</span>
            <div class="comment-text more">${contentContent}</div>
            </div>`
          }
          // l(comments)
          $('#commentContainer').html(comments)
        },error:function(err){
          console.error(err)
        }
      })
      })
      $("#editPostButton").on('click',() => {
        $('#editPostContent').val($('#contentOfPost').text())
      })
      $("#deletePostButton").on('click',() => {
      })
      $('#editForm').on('success',() => {
        $('#contentOfPost').text($('#editPostContent').val());
        $('#editCancel').click()
      })
    </script>
  </body>
</html>
